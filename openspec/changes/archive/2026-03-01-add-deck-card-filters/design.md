## Context

目前牌組詳情頁（`apps/web/src/app/pages/deck-detail`）已提供關鍵字搜尋，且卡片清單過濾邏輯由前端 `computed` 在記憶體中處理。這次需求是在搜尋欄右側新增 `Filter`，先提供三個固定選項（七天內到期、新卡片、三天內到期），並與既有搜尋行為一起運作。

## Goals / Non-Goals

**Goals:**

- 在不破壞既有搜尋體驗下，新增可操作的卡片篩選功能。
- 明確定義三個篩選條件的判斷邏輯，確保前端行為可測試。
- 維持目前資料流（先載入卡片，再前端過濾），降低改動範圍。

**Non-Goals:**

- 本次不新增自訂日期區間或多選複合篩選。
- 本次不變更卡片列表 API 契約（不新增後端查詢參數）。
- 本次不調整卡片排序規則與分頁策略。

## Decisions

1. 以單選篩選模式實作

- 決策：`Filter` 一次只允許選擇一個條件，預設為「全部卡片」。
- 理由：需求僅指定先提供三個選項，單選可避免「三天內」與「七天內」疊加造成語意衝突，降低 UI 與測試複雜度。
- 替代方案：多選條件（AND/OR）較彈性，但需要額外定義優先順序與交集語意，超出本次範圍。

2. 保持前端本地過濾，不改 API

- 決策：沿用 `DeckDetailComponent` 既有 `cards + computed` 模式，在前端同時套用搜尋字串與 filter 條件。
- 理由：現況即為前端搜尋過濾，需求範圍小且選項固定，前端處理可快速交付並避免擴增 OpenAPI/後端改動。
- 替代方案：改為後端過濾可降低大清單前端運算，但會新增 API 參數與契約變更，導致跨模組成本提高。

3. 篩選條件判斷規則

- 決策：
  - 七天內到期：`state != NEW` 且 `due` 存在，且 `due` 在 `now` 到 `now + 7 days`（含邊界）。
  - 三天內到期：`state != NEW` 且 `due` 存在，且 `due` 在 `now` 到 `now + 3 days`（含邊界）。
  - 尚未練習的新卡片：`state == NEW`。
- 理由：規則直接對應既有卡片欄位 `state`/`due`，可重用現有資料結構並保持可預期行為。
- 替代方案：將逾期卡片也納入「N 天內到期」，可提升覆蓋但語意會從「即將到期」變成「到期前後」，本次不採用。

4. 搜尋與篩選的組合邏輯

- 決策：列表結果 SHALL 同時滿足「關鍵字搜尋」與「filter 條件」（交集）。
- 理由：使用者可先縮小語意範圍再按時程篩選，行為最直覺且一致。
- 替代方案：讓 filter 覆蓋搜尋或分開模式會造成切換時認知成本增加。

## Risks / Trade-offs

- [風險] 時區與 `due` 邊界造成臨界卡片判斷不一致 → [緩解] 以單一 `now` 時點計算，並在 domain 測試覆蓋邊界值（剛好 3 天/7 天、null due、NEW）。
- [取捨] 前端本地過濾在超大卡片量時可能有效能壓力 → [緩解] 本次維持現況；若後續清單規模成長，再評估 API server-side filter。
- [風險] UI 元件選型（下拉/彈出）若與現有設計不一致可能影響一致性 → [緩解] 優先沿用 `@flashmind/ui` 現成互動模式與 testId 規範。
