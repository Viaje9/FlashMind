<!DOCTYPE html><html lang="zh-tw"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="記錄頁首設定按鈕消失的根因與修正思路。"><meta name="generator" content="Astro v5.16.6"><title>頁首右上設定消失問題（內容投影）｜FlashMind 文件速覽</title><link rel="icon" type="image/svg+xml" href="/FlashMind/docs/favicon.svg"><link rel="stylesheet" href="/FlashMind/docs/_astro/_slug_.DEJltvy_.css"></head> <body> <a class="skip-link" href="#main">跳到主要內容</a> <header class="site-header"> <div class="brand"> <span class="brand-mark">FM</span> <div class="brand-text"> <span class="brand-title">FlashMind 文件速覽</span> <span class="brand-subtitle">手機優先 · 快速查閱</span> </div> </div> <nav class="header-actions"> <a class="ghost-link" href="/FlashMind/docs/">文件首頁</a> </nav> </header> <main id="main" class="site-main">  <article class="doc-page"> <div class="doc-top"> <a class="back-link" href="/FlashMind/docs/">← 回到文件列表</a> <span class="doc-id">文件</span> </div> <header class="doc-header"> <h1>頁首右上設定消失問題（內容投影）</h1> <p class="doc-summary">記錄頁首設定按鈕消失的根因與修正思路。</p> </header> <section class="doc-source" aria-label="GitHub 路徑"> <div class="doc-source__meta"> <h2>GitHub 檔案路徑</h2> <p>需要貼到 issue 或 PR 時可直接複製。</p> </div> <div class="doc-source__actions"> <button class="button button-primary" type="button" data-copy-url="https://raw.githubusercontent.com/viaje9/FlashMind/main/apps/docs-viewer/src/content/docs/page-header-content-projection-issue.md">
複製路徑
</button> <span class="doc-source__status" data-copy-status aria-live="polite"></span> </div> <div class="doc-source__url"> <code>https://raw.githubusercontent.com/viaje9/FlashMind/main/apps/docs-viewer/src/content/docs/page-header-content-projection-issue.md</code> </div> </section> <details class="toc" open> <summary>目錄</summary> <ul> <li class="toc-item depth-2"> <a href="#問題描述">問題描述</a> </li><li class="toc-item depth-2"> <a href="#根因">根因</a> </li><li class="toc-item depth-2"> <a href="#錯誤範例保留原始寫法bad-example">錯誤範例（保留原始寫法）${#bad-example}</a> </li><li class="toc-item depth-2"> <a href="#解法">解法</a> </li><li class="toc-item depth-2"> <a href="#解決方式修正後範例">解決方式（修正後範例）</a> </li><li class="toc-item depth-2"> <a href="#變更摘要">變更摘要</a> </li><li class="toc-item depth-2"> <a href="#驗證方式">驗證方式</a> </li><li class="toc-item depth-2"> <a href="#教訓避免再次發生">教訓/避免再次發生</a> </li> </ul> </details> <div class="doc-content"> <h1 id="頁首右上設定消失問題內容投影">頁首右上設定消失問題（內容投影）</h1>
<h2 id="問題描述">問題描述</h2>
<ul>
<li>頁面：<code>/decks</code></li>
<li>現象：頁首右上「設定」按鈕不見。</li>
</ul>
<h2 id="根因">根因</h2>
<p><code>fm-page-header</code> 使用 Angular 內容投影（<code>&#x3C;ng-content></code>）來放左/右側操作按鈕，但模板中用 <code>@if / @else</code> 分成兩套結構，各自包含一組 <code>ng-content</code>。</p>
<p>Angular 的投影內容只會分配到「第一組」符合的 <code>ng-content</code>。因此在 <code>layout="start"</code> 時，左右 slot 落在另一個未渲染分支，導致右側按鈕消失。</p>
<h2 id="錯誤範例保留原始寫法bad-example">錯誤範例（保留原始寫法）{#bad-example}</h2>
<p>以下是當時的寫法（重複投影點），用來對照問題來源：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#E1E4E8">@if (layout() === 'center') {</span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"flex items-center gap-3"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">ng-content</span><span style="color:#B392F0"> select</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"[slot=left]"</span><span style="color:#E1E4E8">>&#x3C;/</span><span style="color:#85E89D">ng-content</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"flex flex-col items-center text-center flex-1"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">h1</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"text-lg font-bold tracking-tight text-slate-900 dark:text-white"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">      {{ title() }}</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/</span><span style="color:#85E89D">h1</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    @if (subtitle()) {</span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#85E89D">span</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"text-xs font-medium text-secondary-text"</span><span style="color:#E1E4E8">>{{ subtitle() }}&#x3C;/</span><span style="color:#85E89D">span</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"flex items-center gap-2"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">ng-content</span><span style="color:#B392F0"> select</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"[slot=right]"</span><span style="color:#E1E4E8">>&#x3C;/</span><span style="color:#85E89D">ng-content</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">} @else {</span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"flex items-center gap-3"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">ng-content</span><span style="color:#B392F0"> select</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"[slot=left]"</span><span style="color:#E1E4E8">>&#x3C;/</span><span style="color:#85E89D">ng-content</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"flex flex-col"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#85E89D">h1</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"text-lg font-bold tracking-tight text-slate-900 dark:text-white"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">        {{ title() }}</span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;/</span><span style="color:#85E89D">h1</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">      @if (subtitle()) {</span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">span</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"text-xs font-medium text-secondary-text"</span><span style="color:#E1E4E8">>{{ subtitle() }}&#x3C;/</span><span style="color:#85E89D">span</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"flex items-center gap-2"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">ng-content</span><span style="color:#B392F0"> select</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"[slot=right]"</span><span style="color:#E1E4E8">>&#x3C;/</span><span style="color:#85E89D">ng-content</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="解法">解法</h2>
<ol>
<li><strong>移除分支內重複的投影點</strong>，改成單一結構承載左右與標題。</li>
<li>以 <code>grid</code> 佈局維持三欄（左/中/右），並用 <code>titleClass</code> 控制標題對齊（置中或靠左）。</li>
<li>左右操作按鈕以 class 標記投影來源：
<ul>
<li>左側：<code>fm-header-left</code></li>
<li>右側：<code>fm-header-right</code></li>
</ul>
</li>
</ol>
<h2 id="解決方式修正後範例">解決方式（修正後範例）</h2>
<p>以下是修正後的 <code>fm-page-header</code> 範例，保留單一投影結構並用 grid 排版：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">header</span><span style="color:#B392F0"> [class]</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"containerClass()"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"flex items-center gap-3"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">ng-content</span><span style="color:#B392F0"> select</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">".fm-header-left"</span><span style="color:#E1E4E8">>&#x3C;/</span><span style="color:#85E89D">ng-content</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> [class]</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"titleClass()"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">h1</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"text-lg font-bold tracking-tight text-slate-900 dark:text-white"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">      {{ title() }}</span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/</span><span style="color:#85E89D">h1</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    @if (subtitle()) {</span></span>
<span class="line"><span style="color:#E1E4E8">      &#x3C;</span><span style="color:#85E89D">span</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"text-xs font-medium text-secondary-text"</span><span style="color:#E1E4E8">>{{ subtitle() }}&#x3C;/</span><span style="color:#85E89D">span</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"flex items-center gap-2 justify-end"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">ng-content</span><span style="color:#B392F0"> select</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">".fm-header-right"</span><span style="color:#E1E4E8">>&#x3C;/</span><span style="color:#85E89D">ng-content</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">header</span><span style="color:#E1E4E8">></span></span></code></pre>
<p>對應的 TypeScript 設定：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="ts"><code><span class="line"><span style="color:#E1E4E8">readonly containerClass </span><span style="color:#F97583">=</span><span style="color:#B392F0"> computed</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> base</span><span style="color:#F97583"> =</span></span>
<span class="line"><span style="color:#9ECBFF">    'grid grid-cols-[auto_minmax(0,1fr)_auto] items-center gap-3 bg-background-light/95 dark:bg-background-dark/95 backdrop-blur-sm transition-colors duration-200'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> spacing</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">dense</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">?</span><span style="color:#9ECBFF"> 'px-4 py-2'</span><span style="color:#F97583"> :</span><span style="color:#9ECBFF"> 'px-4 py-3'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> sticky</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">sticky</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">?</span><span style="color:#9ECBFF"> 'sticky top-0 z-30'</span><span style="color:#F97583"> :</span><span style="color:#9ECBFF"> ''</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> [base, spacing, sticky].</span><span style="color:#B392F0">filter</span><span style="color:#E1E4E8">(Boolean).</span><span style="color:#B392F0">join</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">' '</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">readonly titleClass </span><span style="color:#F97583">=</span><span style="color:#B392F0"> computed</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> base</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> 'flex flex-col'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> align</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">layout</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">===</span><span style="color:#9ECBFF"> 'center'</span><span style="color:#F97583"> ?</span><span style="color:#9ECBFF"> 'items-center text-center'</span><span style="color:#F97583"> :</span><span style="color:#9ECBFF"> 'items-start text-left'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> [base, align].</span><span style="color:#B392F0">join</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">' '</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h2 id="變更摘要">變更摘要</h2>
<ul>
<li><code>packages/ui/src/lib/molecules/page-header/page-header.component.html</code>
<ul>
<li>移除 <code>@if/@else</code> 內的重複 <code>ng-content</code>，改為單一結構。</li>
</ul>
</li>
<li><code>packages/ui/src/lib/molecules/page-header/page-header.component.ts</code>
<ul>
<li>新增 <code>titleClass</code>，依 <code>layout</code> 控制標題對齊。</li>
<li><code>containerClass</code> 改用有效的 <code>grid-template-columns</code>。</li>
</ul>
</li>
<li>使用頁面（例如 <code>deck-list</code>, <code>settings</code> 等）將原本的 <code>slot=left/right</code> 改為 <code>class="fm-header-left/right"</code>。</li>
</ul>
<h2 id="驗證方式">驗證方式</h2>
<ul>
<li>Chrome DevTools 檢查 <code>/decks</code> 頁首是否出現右上「設定」。</li>
<li>檢查 <code>/settings</code> 是否有左側返回與右側完成按鈕。</li>
</ul>
<h2 id="教訓避免再次發生">教訓/避免再次發生</h2>
<ul>
<li>內容投影不要放在互斥的 template 分支中；必要時用單一結構與樣式控制呈現差異。</li>
<li>若要支援多種版型，優先用 class 或 layout 變數調整，而不是用 <code>@if</code> 複製整段 HTML。</li>
</ul> </div> <footer class="doc-footer"> <a class="button button-ghost" href="/FlashMind/docs/">回到列表</a> </footer> </article>  </main> <button class="to-top" type="button" aria-label="回到頁首"> <span aria-hidden="true">↑</span>
回到頁首
</button> <footer class="site-footer"> <span>FlashMind 文件工具 · 輕量版</span> <span>以行動閱讀為核心設計</span> </footer> <script type="module">const o=document.querySelector(".to-top");if(o){const t=()=>{const s=window.scrollY>240;o.classList.toggle("is-visible",s)};t(),window.addEventListener("scroll",t,{passive:!0}),o.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})}</script> </body> </html> <script type="module">const e=document.querySelector("[data-copy-url]"),n=document.querySelector("[data-copy-status]");if(e){const a=e.textContent?.trim()??"複製路徑",c=e.dataset.copyUrl??"";e.addEventListener("click",async()=>{let o=!1;try{await navigator.clipboard.writeText(c),o=!0}catch{const t=document.createElement("textarea");t.value=c,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),t.select(),o=document.execCommand("copy"),document.body.removeChild(t)}e.textContent=o?"已複製":"複製失敗",n&&(n.textContent=o?"已複製到剪貼簿":"複製失敗，請手動複製"),window.setTimeout(()=>{e.textContent=a,n&&(n.textContent="")},1600)})}</script>