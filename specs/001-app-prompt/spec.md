# 功能規格：快閃卡核心體驗與牌組管理

**功能分支**：`001-app-prompt`  
**建立日期**：2025-10-19  
**狀態**：草稿  
**輸入**：使用者描述：「這是一個快閃卡 APP 請閱讀 prompt.md 取得需求更多細節」

> 憲法防線：雲端同步需支援匿名轉登入並維持 FSRS 排程一致，滑動手勢分級直接決定 FSRS 間隔調整，Deck/Card 資料契約須擴充以保存 AI 生成內容與滑動紀錄，必備測試需覆蓋離線重播、手勢排程與 AI 回退，錯誤訊息至少涵蓋 AI 生成失敗與同步衝突，UI／Storybook 需新增複習滑動、牌組管理與 AI 編輯狀態稿。

## 使用情境與測試（必填）

### 使用者故事 1 - 滑動式單字複習（優先度：P1）

通勤中的學習者想在零碎時間開啟複習模式，透過左／上／右滑快速標記熟悉度並回到日常。

**優先原因**：此滑動體驗是產品的核心價值，直接影響留存與口碑。

**獨立測試方法**：啟動複習畫面，以測試帳號手動建立 6 張卡片，驗證三種滑動方向對再現時間與進度儀表的影響是否符合規則。

**驗收情境**：

1. **給定** 使用者進入複習模式並看到到期卡片，**當** 左滑卡片，**則** 該卡需在 10、20、40 分鐘後依序再現且明日必再出現。
2. **給定** 使用者滑動上方表示「有點難」，**當** 上滑卡片，**則** 該卡於今日隱藏並在明日的待複習列表中排於最前。
3. **給定** 使用者右滑表示「輕鬆」，**當** 右滑卡片，**則** 該卡今日不再出現且下一次出現間隔延長至 3–5 天並被記錄於統計面板。
4. **給定** 使用者完成當日所有待複習卡片，**當** 最後一張卡片被標記完成，**則** 系統顯示「今日完成」畫面並提供返回首頁與檢視明日預覽的選項。

---

### 使用者故事 2 - 建立與管理牌組（優先度：P2）

語言學習者希望替不同主題建立獨立牌組，避免混淆旅遊、科技等語境。

**優先原因**：主題分組能降低記憶干擾並支援長期規模擴張。

**獨立測試方法**：建立兩個牌組並分別新增卡片，確認內容、排程與統計皆分離。

**驗收情境**：

1. **給定** 使用者建立名為「旅遊英文」的牌組並新增 5 張卡片，**當** 返回牌組列表，**則** 該牌組僅顯示這 5 張卡片且統計僅包含其中資料。
2. **給定** 使用者在「旅遊英文」與「科技英文」牌組各新增單字「drone」，**當** 分別進入兩個牌組複習，**則** 系統視為兩張獨立卡片，進度互不影響。
3. **給定** 使用者調整「旅遊英文」的每日新卡上限至 15 張，**當** 隔日回到複習模式，**則** 僅該牌組套用新上限，其他牌組保持原設定。

---

### 使用者故事 3 - AI 協助新增單字（優先度：P3）

忙碌的使用者想輸入單字後立即取得義項、例句與翻譯，並保有調整權限。

**優先原因**：降低內容蒐集成本，提升持續建立牌組的動機。

**獨立測試方法**：輸入單字「run」，檢視生成的多義內容、重生功能與手動編輯儲存流程。

**驗收情境**：

1. **給定** 使用者在牌組內新增卡片並輸入「run」，**當** 按下「產生內容」，**則** 系統顯示多個義項、對應例句與中譯，並標示內容來源為 AI。
2. **給定** 使用者對生成內容不滿意，**當** 按下「重生」，**則** 系統提供另一組義項與例句並保留舊內容以供比較。
3. **給定** AI 無法產生內容或網路中斷，**當** 生成失敗，**則** 系統顯示可讀錯誤訊息並自動切換至手動輸入模式。
4. **給定** 使用者完成編輯並儲存，**當** 回到牌組列表，**則** 新卡片出現在指定牌組並加入排程。

---

### 使用者故事 4 - 底部導覽列快速切換（優先度：P4）

使用者希望在首頁、牌組與設定間快速切換，同時保持複習模式的沉浸體驗。

**優先原因**：清楚的導覽結構降低新手學習成本並提升操作效率。

**獨立測試方法**：在測試裝置逐一點擊三個導覽 icon，確認畫面切換、選中狀態與複習畫面的隱藏行為。

**驗收情境**：

1. **給定** 使用者停留在首頁，**當** 點擊導覽列中的「牌組」icon，**則** 立即切換至牌組頁面並顯示對應選中狀態。
2. **給定** 使用者進入複習畫面，**當** 複習介面載入完成，**則** 底部導覽列自動隱藏並保留系統手勢安全區域。
3. **給定** 使用者結束複習並返回首頁，**當** 導覽列重新出現，**則** 維持先前的選中狀態與可點擊性。

---

### 邊界案例

- 使用者在離線狀態完成複習後重新連線時，需將滑動評分與排程變更安全重播至雲端並避免重複出現同一張卡片。
- 同一張卡片若在不同裝置上於同日被評分類似行為，系統需採用最近一次滑動結果並記錄於衝突日誌供客服檢視。
- AI 生成內容若包含多義字，需依義項順序顯示並允許使用者收合不需要的義項。
- 同一天內若 FSRS 排程計畫再次推送同一張卡片，系統需自動略過並標記為「當日已完成」避免干擾體驗。
- 使用者連續大量左滑（Again）時，系統應提示是否降低當日新卡量並尊重使用者選擇。
- 雲端同步失敗或資料契約驗證錯誤時，需提供錯誤通知並保護本地資料不被覆寫。

## 假設

- 匿名使用者在首次啟動時自動建立預設牌組，登入後沿用既有資料並於首次同步時解決重複卡片。
- AI 生成服務可返回至少三個義項與對應例句，若不足時視為生成失敗並啟用手動模式。
- 每個牌組預設每日新增 10 張卡片，上限可在 5–30 張之間設定；若使用者未調整則沿用預設值。

## 需求（必填）

### 功能性需求

- **FR-001**：系統必須允許使用者建立、命名、重新排序與刪除牌組，並於刪除前提供影響提醒。
- **FR-002**：每個牌組必須獨立管理待複習清單、FSRS 排程與統計資訊，互不影響。
- **FR-003**：複習介面必須支援左滑（Again）、上滑（Hard）、右滑（Easy）手勢，並依規則更新卡片再現時間（10→20→40 分鐘、明日優先、3–5 天延長）。
- **FR-004**：複習介面必須在第一次載入時顯示手勢提示（左滑＝忘記、上滑＝有點難、右滑＝輕鬆），使用者可在設定中重新開啟提示。
- **FR-005**：系統必須在卡片於同一天再次被排程時自動略過並記錄於活動紀錄，以避免重複曝光。
- **FR-006**：系統完成當日待複習卡片後必須顯示「今日完成」畫面，提供返回首頁、檢視明日預估與分享進度的選項。
- **FR-007**：卡片建立流程必須允許輸入單字並由 AI 生成義項、例句與翻譯，使用者可逐項編輯並覆蓋 AI 內容。
- **FR-008**：當 AI 生成失敗或回應超時時，系統必須提供清楚的錯誤訊息、保留使用者輸入並自動切換至手動編輯模式。
- **FR-009**：系統必須允許使用者為每個牌組設定每日新卡上限（預設 10 張），並在大量 Again 評分時提供降低上限的建議提示。
- **FR-010**：複習模式必須允許使用者持續複習所有到期與重新排程卡片，並即時更新卡片完成率與連勝紀錄。
- **FR-011**：系統必須支援匿名模式與登入同步；登入後需將本地與雲端資料合併並保持卡片排程一致。
- **FR-012**：離線狀態下的滑動結果必須在連線恢復後自動同步至雲端，衝突時以最新滑動時間為準並提供檢視紀錄。
- **FR-013**：底部導覽列必須固定顯示首頁、牌組、設定三個 icon，提供當前頁面高亮，並在複習介面自動隱藏。
- **FR-014**：資料契約需擴充以儲存卡片的義項陣列、例句、翻譯、生成來源、手動覆蓋標記與 FSRS 排程屬性，並確保跨裝置同步時維持相容性。
- **FR-015**：產品必須提供 Storybook（或同等元件樣板）場景展示複習卡片、AI 編輯狀態與底部導覽列，以支援設計審核與手動測試。
- **FR-016**：必備測試須包含滑動排程規則、AI 生成失敗回退、離線複習後同步、每日新卡上限調整與匿名轉登入同步流程。

### 關鍵實體（若有資料模型）

- **User**：代表匿名或登入的學習者，包含身分狀態、最後同步時間、每日新卡預設值與個人化提示設定。
- **Deck（牌組）**：主題集合，擁有名稱、顏色或圖示設定、每日新卡上限、統計資料（完成率、連勝天數）與 FSRS 排程佇列。
- **Card（卡片）**：單字單位，包含單字本體、義項陣列、例句、翻譯、生成來源標記、手動覆蓋記錄、最新滑動行為與排程狀態。
- **Review Session**：一次複習流程的摘要，記錄起訖時間、操作裝置、完成率與提示調整決策，用於分析與同步衝突排查。

## 成功指標（必填）

### 可量測成果

- **SC-001**：90% 的複習手勢在 1 秒內給予使用者可見回饋，維持流暢體驗。
- **SC-002**：80% 的活躍使用者能在每日提醒後完成當日全部到期卡片。
- **SC-003**：70% 的新卡片在首次 AI 生成後無需使用者額外編輯即可儲存。
- **SC-004**：登入同步後 95% 的測試案例於 5 分鐘內在所有裝置呈現一致的待複習卡片數量與排程狀態。
- **SC-005**：導覽列可用性調查顯示 85% 使用者表示能在 3 秒內找到所需主頁面。
