# 牌組管理 E2E 測試計劃

## Application Overview

FlashMind 牌組管理功能的完整 E2E 測試計劃，涵蓋牌組列表檢視、建立、編輯、刪除等核心功能。測試範圍包括正常流程、驗證邏輯、錯誤處理和邊界條件。

## Test Scenarios

### 1. US-010: 檢視牌組列表

**Seed:** `e2e/tests/seed.spec.ts`

#### 1.1. 6.1.1 測試顯示牌組列表

**File:** `e2e/tests/deck/deck-list-display.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 透過 API 建立 3 個測試牌組，名稱分別為「日文 N5 單字」、「英文托福」、「數學公式」
  3. 重新整理頁面或導航至 /decks
  4. 驗證頁面標題顯示「FlashMind」
  5. 驗證搜尋框顯示並有正確的 placeholder「搜尋牌組...」
  6. 驗證 3 個牌組都顯示在列表中
  7. 驗證每個牌組卡片顯示牌組名稱
  8. 驗證新增牌組按鈕（+ 圖示）顯示在右下角

**Expected Results:**
  - 測試帳號註冊並登入成功，導向 /decks 頁面
  - 3 個測試牌組建立成功
  - 頁面重新載入完成
  - 頁面標題「FlashMind」可見
  - 搜尋框可見且 placeholder 正確
  - 所有 3 個牌組名稱都在頁面上可見
  - 每個牌組卡片都顯示對應的名稱
  - 新增牌組按鈕在右下角可見且可點擊

#### 1.2. 6.1.2 測試顯示學習進度

**File:** `e2e/tests/deck/deck-list-progress.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 透過 API 建立測試牌組「學習進度測試」
  3. 重新整理頁面
  4. 驗證牌組卡片顯示學習統計資訊（新卡片數、待複習數）
  5. 驗證進度條元素存在
  6. 驗證創建日期顯示

**Expected Results:**
  - 測試帳號登入成功
  - 測試牌組建立成功
  - 頁面重新載入完成
  - 牌組卡片顯示「0 新卡片」和「0 待複習」（新建牌組無卡片）
  - 進度條元素可見
  - 創建日期以合理格式顯示

#### 1.3. 6.1.3 測試開始學習入口

**File:** `e2e/tests/deck/deck-list-study-entry.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 透過 API 建立測試牌組「學習入口測試」
  3. 重新整理頁面
  4. 點擊牌組卡片
  5. 驗證導航至牌組詳情頁 /decks/:id
  6. 驗證詳情頁顯示正確的牌組名稱

**Expected Results:**
  - 測試帳號登入成功
  - 測試牌組建立成功
  - 頁面重新載入完成
  - 牌組卡片可點擊
  - URL 變更為 /decks/{deck_id}
  - 詳情頁標題顯示「學習入口測試」

#### 1.4. 6.1.4 測試空狀態顯示

**File:** `e2e/tests/deck/deck-list-empty-state.spec.ts`

**Steps:**
  1. 使用 API 建立全新測試帳號並登入（不建立任何牌組）
  2. 驗證導航至 /decks 頁面
  3. 驗證空狀態圖示顯示（library_add icon）
  4. 驗證空狀態標題「尚無牌組」顯示
  5. 驗證空狀態提示「點擊右下角 + 按鈕建立第一個牌組」顯示
  6. 驗證新增牌組按鈕顯示

**Expected Results:**
  - 全新帳號登入成功，導向 /decks 頁面
  - URL 為 /decks
  - 空狀態圖示可見
  - 「尚無牌組」文字可見
  - 提示文字可見
  - 新增牌組按鈕在右下角可見

#### 1.5. 6.1.5 測試搜尋牌組功能

**File:** `e2e/tests/deck/deck-list-search.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 透過 API 建立 5 個測試牌組，名稱分別為「日文 N5 單字」、「日文 N4 單字」、「英文托福」、「數學公式」、「物理定理」
  3. 重新整理頁面
  4. 在搜尋框輸入「日文」
  5. 驗證只顯示包含「日文」的牌組（2 個）
  6. 清空搜尋框
  7. 驗證所有牌組再次顯示（5 個）
  8. 在搜尋框輸入「不存在的牌組」
  9. 驗證顯示無搜尋結果的提示

**Expected Results:**
  - 測試帳號登入成功
  - 5 個測試牌組建立成功
  - 頁面重新載入完成
  - 搜尋框接受輸入
  - 只顯示「日文 N5 單字」和「日文 N4 單字」兩個牌組
  - 搜尋框清空
  - 所有 5 個牌組都顯示
  - 搜尋框接受輸入
  - 顯示適當的無結果訊息

### 2. US-012: 建立新牌組

**Seed:** `e2e/tests/seed.spec.ts`

#### 2.1. 6.2.1 測試開啟建立表單

**File:** `e2e/tests/deck/deck-create-open-form.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 在牌組列表頁面點擊右下角「新增牌組」按鈕（+ 圖示）
  3. 驗證導航至 /decks/new
  4. 驗證頁面標題顯示「新增牌組」
  5. 驗證返回按鈕顯示
  6. 驗證牌組名稱輸入框顯示，placeholder 為「例如：日文 N5 單字」
  7. 驗證「學習計畫設定」標題顯示
  8. 驗證「每日新卡數」數字輸入框顯示，預設值為 20
  9. 驗證「每日複習數」數字輸入框顯示，預設值為 100
  10. 驗證提示文字顯示
  11. 驗證「儲存設定」按鈕顯示
  12. 驗證「取消」按鈕顯示

**Expected Results:**
  - 測試帳號登入成功
  - 新增牌組按鈕可點擊
  - URL 變更為 /decks/new
  - 頁面標題「新增牌組」可見
  - 返回按鈕（arrow_back icon）可見
  - 牌組名稱輸入框可見且 placeholder 正確
  - 「學習計畫設定」標題可見
  - 每日新卡數輸入框顯示 20
  - 每日複習數輸入框顯示 100
  - 提示文字「您可以隨時在牌組設定中更改這些數值...」可見
  - 儲存設定按鈕可見
  - 取消按鈕可見

#### 2.2. 6.2.2 測試填寫並儲存牌組（成功流程）

**File:** `e2e/tests/deck/deck-create-save-success.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 導航至 /decks/new
  3. 在牌組名稱輸入框輸入「我的測試牌組」
  4. 保持預設的每日新卡數（20）和每日複習數（100）
  5. 點擊「儲存設定」按鈕
  6. 等待 API 請求完成
  7. 驗證導航至牌組詳情頁 /decks/:id
  8. 驗證詳情頁顯示正確的牌組名稱「我的測試牌組」

**Expected Results:**
  - 測試帳號登入成功
  - 成功導航至建立頁面
  - 牌組名稱輸入框接受輸入
  - 數字輸入保持預設值
  - 儲存設定按鈕可點擊
  - API 請求成功（POST /decks 返回 201）
  - URL 變更為 /decks/{new_deck_id}
  - 詳情頁標題顯示「我的測試牌組」

#### 2.3. 6.2.3 測試設定每日學習數

**File:** `e2e/tests/deck/deck-create-custom-limits.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 導航至 /decks/new
  3. 在牌組名稱輸入框輸入「自訂設定牌組」
  4. 點擊每日新卡數輸入框，清空後輸入「30」
  5. 點擊每日複習數輸入框，清空後輸入「150」
  6. 點擊「儲存設定」按鈕
  7. 等待導航至詳情頁
  8. 導航至牌組設定頁面 /decks/:id/settings
  9. 驗證每日新卡數顯示為「30」
  10. 驗證每日複習數顯示為「150」

**Expected Results:**
  - 測試帳號登入成功
  - 成功導航至建立頁面
  - 牌組名稱輸入框接受輸入
  - 每日新卡數輸入框接受並顯示「30」
  - 每日複習數輸入框接受並顯示「150」
  - 儲存設定按鈕可點擊
  - 成功導航至詳情頁
  - 成功導航至設定頁面
  - 每日新卡數欄位顯示「30」
  - 每日複習數欄位顯示「150」

#### 2.4. 6.2.4 測試驗證錯誤（空牌組名稱）

**File:** `e2e/tests/deck/deck-create-validation-empty-name.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 導航至 /decks/new
  3. 不輸入牌組名稱，保持空白
  4. 點擊「儲存設定」按鈕
  5. 驗證顯示錯誤訊息「請輸入牌組名稱」
  6. 驗證仍停留在 /decks/new 頁面
  7. 在牌組名稱輸入框輸入「有效的牌組名稱」
  8. 再次點擊「儲存設定」按鈕
  9. 驗證錯誤訊息消失
  10. 驗證成功導航至詳情頁

**Expected Results:**
  - 測試帳號登入成功
  - 成功導航至建立頁面
  - 牌組名稱輸入框保持空白
  - 儲存設定按鈕可點擊
  - 錯誤訊息「請輸入牌組名稱」顯示
  - URL 仍為 /decks/new
  - 牌組名稱輸入框接受輸入
  - 儲存設定按鈕可點擊
  - 錯誤訊息不再顯示
  - 成功導航至 /decks/{deck_id}

#### 2.5. 6.2.5 測試取消建立

**File:** `e2e/tests/deck/deck-create-cancel.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 導航至 /decks/new
  3. 在牌組名稱輸入框輸入「將被取消的牌組」
  4. 修改每日新卡數為「25」
  5. 點擊「取消」按鈕
  6. 驗證導航回牌組列表頁 /decks
  7. 驗證牌組列表中不包含「將被取消的牌組」（或顯示空狀態）

**Expected Results:**
  - 測試帳號登入成功
  - 成功導航至建立頁面
  - 牌組名稱輸入框接受輸入
  - 每日新卡數輸入框接受修改
  - 取消按鈕可點擊
  - URL 變更為 /decks
  - 列表中沒有「將被取消的牌組」，牌組未被建立

#### 2.6. 6.2.6 測試數字輸入範圍驗證

**File:** `e2e/tests/deck/deck-create-validation-number-range.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 導航至 /decks/new
  3. 在牌組名稱輸入框輸入「範圍測試」
  4. 嘗試在每日新卡數輸入框輸入「3」（小於最小值 5）
  5. 驗證輸入框值自動調整為「5」或顯示驗證錯誤
  6. 嘗試在每日新卡數輸入框輸入「101」（大於最大值 100）
  7. 驗證輸入框值自動調整為「100」或顯示驗證錯誤
  8. 嘗試在每日複習數輸入框輸入「5」（小於最小值 10）
  9. 驗證輸入框值自動調整為「10」或顯示驗證錯誤
  10. 嘗試在每日複習數輸入框輸入「501」（大於最大值 500）
  11. 驗證輸入框值自動調整為「500」或顯示驗證錯誤

**Expected Results:**
  - 測試帳號登入成功
  - 成功導航至建立頁面
  - 牌組名稱輸入框接受輸入
  - 每日新卡數輸入框不接受小於 5 的值
  - 輸入框值為「5」或顯示錯誤
  - 每日新卡數輸入框不接受大於 100 的值
  - 輸入框值為「100」或顯示錯誤
  - 每日複習數輸入框不接受小於 10 的值
  - 輸入框值為「10」或顯示錯誤
  - 每日複習數輸入框不接受大於 500 的值
  - 輸入框值為「500」或顯示錯誤

#### 2.7. 6.2.7 測試返回按鈕功能

**File:** `e2e/tests/deck/deck-create-back-button.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 導航至 /decks/new
  3. 在牌組名稱輸入框輸入「測試返回」
  4. 點擊左上角返回按鈕（arrow_back icon）
  5. 驗證導航回牌組列表頁 /decks
  6. 驗證牌組列表中不包含「測試返回」

**Expected Results:**
  - 測試帳號登入成功
  - 成功導航至建立頁面
  - 牌組名稱輸入框接受輸入
  - 返回按鈕可點擊
  - URL 變更為 /decks
  - 牌組未被建立

### 3. US-013: 編輯牌組設定

**Seed:** `e2e/tests/seed.spec.ts`

#### 3.1. 6.3.1 測試進入設定頁面

**File:** `e2e/tests/deck/deck-settings-open.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 透過 API 建立測試牌組「設定測試牌組」（dailyNewCards: 20, dailyReviewCards: 100）
  3. 導航至牌組列表頁
  4. 點擊「設定測試牌組」進入詳情頁
  5. 點擊右上角「設定」按鈕（settings icon）
  6. 驗證導航至 /decks/:id/settings
  7. 驗證頁面標題顯示「牌組設定」
  8. 驗證返回按鈕顯示
  9. 驗證牌組名稱輸入框顯示並已填入「設定測試牌組」
  10. 驗證每日新卡數輸入框顯示「20」
  11. 驗證每日複習數輸入框顯示「100」
  12. 驗證「學習計畫設定」區塊顯示
  13. 驗證「危險區域」區塊顯示
  14. 驗證「刪除牌組」按鈕顯示
  15. 驗證「儲存設定」按鈕顯示
  16. 驗證「取消」按鈕顯示

**Expected Results:**
  - 測試帳號登入成功
  - 測試牌組建立成功
  - 成功導航至列表頁
  - 牌組卡片可點擊，導航至詳情頁
  - 設定按鈕可點擊
  - URL 變更為 /decks/{deck_id}/settings
  - 頁面標題「牌組設定」可見
  - 返回按鈕可見
  - 牌組名稱輸入框顯示「設定測試牌組」
  - 每日新卡數輸入框顯示「20」
  - 每日複習數輸入框顯示「100」
  - 「學習計畫設定」標題可見
  - 「危險區域」標題可見
  - 紅色「刪除牌組」按鈕可見
  - 「儲存設定」按鈕可見
  - 「取消」按鈕可見

#### 3.2. 6.3.2 測試修改並儲存設定

**File:** `e2e/tests/deck/deck-settings-update.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 透過 API 建立測試牌組「原始名稱」（dailyNewCards: 20, dailyReviewCards: 100）
  3. 透過牌組列表導航至牌組設定頁 /decks/:id/settings
  4. 將牌組名稱修改為「更新後的名稱」
  5. 將每日新卡數修改為「35」
  6. 將每日複習數修改為「200」
  7. 點擊「儲存設定」按鈕
  8. 等待 API 請求完成
  9. 驗證導航回牌組詳情頁 /decks/:id
  10. 驗證詳情頁標題顯示「更新後的名稱」
  11. 返回設定頁驗證修改已保存
  12. 驗證牌組名稱為「更新後的名稱」
  13. 驗證每日新卡數為「35」
  14. 驗證每日複習數為「200」

**Expected Results:**
  - 測試帳號登入成功
  - 測試牌組建立成功
  - 成功導航至設定頁面
  - 牌組名稱輸入框接受修改
  - 每日新卡數輸入框接受修改
  - 每日複習數輸入框接受修改
  - 儲存設定按鈕可點擊
  - API 請求成功（PATCH /decks/:id 返回 200）
  - URL 變更為 /decks/{deck_id}
  - 詳情頁標題顯示更新後的名稱
  - 成功返回設定頁
  - 牌組名稱保持為「更新後的名稱」
  - 每日新卡數保持為「35」
  - 每日複習數保持為「200」

#### 3.3. 6.3.3 測試只修改部分欄位

**File:** `e2e/tests/deck/deck-settings-partial-update.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 透過 API 建立測試牌組「部分更新測試」（dailyNewCards: 20, dailyReviewCards: 100）
  3. 導航至牌組設定頁
  4. 只修改牌組名稱為「只改名稱」，保持其他欄位不變
  5. 點擊「儲存設定」按鈕
  6. 驗證更新成功並返回詳情頁
  7. 返回設定頁驗證
  8. 驗證牌組名稱為「只改名稱」
  9. 驗證每日新卡數仍為「20」
  10. 驗證每日複習數仍為「100」

**Expected Results:**
  - 測試帳號登入成功
  - 測試牌組建立成功
  - 成功導航至設定頁面
  - 牌組名稱輸入框接受修改
  - 儲存設定按鈕可點擊
  - API 請求成功，導航至詳情頁
  - 成功返回設定頁
  - 牌組名稱已更新
  - 每日新卡數保持原值
  - 每日複習數保持原值

#### 3.4. 6.3.4 測試取消修改

**File:** `e2e/tests/deck/deck-settings-cancel.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 透過 API 建立測試牌組「取消測試」（dailyNewCards: 20, dailyReviewCards: 100）
  3. 導航至牌組設定頁
  4. 將牌組名稱修改為「這個修改會被取消」
  5. 將每日新卡數修改為「50」
  6. 點擊「取消」按鈕
  7. 驗證導航回牌組詳情頁
  8. 驗證詳情頁標題仍顯示原始名稱「取消測試」
  9. 返回設定頁
  10. 驗證牌組名稱仍為「取消測試」
  11. 驗證每日新卡數仍為「20」

**Expected Results:**
  - 測試帳號登入成功
  - 測試牌組建立成功
  - 成功導航至設定頁面
  - 輸入框接受修改
  - 輸入框接受修改
  - 取消按鈕可點擊
  - URL 變更為 /decks/{deck_id}
  - 詳情頁標題保持原始值
  - 成功返回設定頁
  - 牌組名稱保持原始值
  - 每日新卡數保持原始值

#### 3.5. 6.3.5 測試設定頁面的返回按鈕

**File:** `e2e/tests/deck/deck-settings-back-button.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 透過 API 建立測試牌組「返回按鈕測試」
  3. 導航至牌組設定頁
  4. 點擊左上角返回按鈕
  5. 驗證導航回牌組詳情頁 /decks/:id

**Expected Results:**
  - 測試帳號登入成功
  - 測試牌組建立成功
  - 成功導航至設定頁面
  - 返回按鈕可點擊
  - URL 變更為 /decks/{deck_id}

#### 3.6. 6.3.6 測試設定頁驗證錯誤

**File:** `e2e/tests/deck/deck-settings-validation.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 透過 API 建立測試牌組「驗證測試」
  3. 導航至牌組設定頁
  4. 清空牌組名稱欄位
  5. 點擊「儲存設定」按鈕
  6. 驗證顯示錯誤訊息（名稱必填）
  7. 驗證仍停留在設定頁面
  8. 輸入有效的牌組名稱「修正後的名稱」
  9. 再次點擊「儲存設定」
  10. 驗證錯誤訊息消失
  11. 驗證成功保存並導航至詳情頁

**Expected Results:**
  - 測試帳號登入成功
  - 測試牌組建立成功
  - 成功導航至設定頁面
  - 牌組名稱欄位被清空
  - 儲存設定按鈕可點擊
  - 錯誤訊息顯示
  - URL 仍為 /decks/{deck_id}/settings
  - 牌組名稱輸入框接受輸入
  - 儲存設定按鈕可點擊
  - 錯誤訊息不再顯示
  - 成功導航至詳情頁

### 4. US-014: 刪除牌組

**Seed:** `e2e/tests/seed.spec.ts`

#### 4.1. 6.4.1 測試刪除確認對話框

**File:** `e2e/tests/deck/deck-delete-dialog.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 透過 API 建立測試牌組「待刪除牌組」
  3. 導航至牌組設定頁 /decks/:id/settings
  4. 向下捲動至「危險區域」區塊
  5. 點擊「刪除牌組」按鈕
  6. 驗證確認對話框出現
  7. 驗證對話框標題為「刪除牌組」
  8. 驗證對話框內容提到牌組名稱「待刪除牌組」
  9. 驗證對話框顯示警告訊息「此操作將刪除所有卡片與學習紀錄，且無法復原」
  10. 驗證對話框有「取消」按鈕
  11. 驗證對話框有「確認」按鈕

**Expected Results:**
  - 測試帳號登入成功
  - 測試牌組建立成功
  - 成功導航至設定頁面
  - 頁面捲動至危險區域
  - 刪除牌組按鈕可點擊
  - 對話框在頁面上方顯示（覆蓋層）
  - 對話框標題「刪除牌組」可見
  - 對話框內容包含「待刪除牌組」
  - 警告訊息可見
  - 取消按鈕可見
  - 確認按鈕可見

#### 4.2. 6.4.2 測試確認刪除

**File:** `e2e/tests/deck/deck-delete-confirm.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 透過 API 建立測試牌組「即將被刪除」
  3. 記錄牌組 ID
  4. 導航至牌組設定頁
  5. 點擊「刪除牌組」按鈕開啟確認對話框
  6. 點擊對話框中的「確認」按鈕
  7. 等待 API 請求完成
  8. 驗證導航回牌組列表頁 /decks
  9. 驗證列表中不再顯示「即將被刪除」牌組
  10. 嘗試直接訪問已刪除牌組的 URL /decks/:id
  11. 驗證顯示 404 或適當的錯誤訊息

**Expected Results:**
  - 測試帳號登入成功
  - 測試牌組建立成功
  - 牌組 ID 已記錄
  - 成功導航至設定頁面
  - 確認對話框顯示
  - 確認按鈕可點擊
  - API 請求成功（DELETE /decks/:id 返回 200 或 204）
  - URL 變更為 /decks
  - 列表中沒有該牌組（或顯示空狀態）
  - 嘗試訪問已刪除牌組的 URL
  - 顯示錯誤訊息或重定向至列表頁

#### 4.3. 6.4.3 測試取消刪除

**File:** `e2e/tests/deck/deck-delete-cancel.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 透過 API 建立測試牌組「不會被刪除」
  3. 導航至牌組設定頁
  4. 點擊「刪除牌組」按鈕開啟確認對話框
  5. 點擊對話框中的「取消」按鈕
  6. 驗證對話框關閉
  7. 驗證仍停留在設定頁面 /decks/:id/settings
  8. 導航回牌組列表頁
  9. 驗證「不會被刪除」牌組仍在列表中
  10. 點擊該牌組進入詳情頁
  11. 驗證牌組可正常訪問

**Expected Results:**
  - 測試帳號登入成功
  - 測試牌組建立成功
  - 成功導航至設定頁面
  - 確認對話框顯示
  - 取消按鈕可點擊
  - 對話框消失，背景頁面可見
  - URL 仍為 /decks/{deck_id}/settings
  - 成功導航至列表頁
  - 「不會被刪除」牌組在列表中可見
  - 牌組卡片可點擊
  - 牌組詳情頁正常顯示

#### 4.4. 6.4.4 測試刪除對話框點擊外部關閉

**File:** `e2e/tests/deck/deck-delete-backdrop-click.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 透過 API 建立測試牌組「測試背景點擊」
  3. 導航至牌組設定頁
  4. 點擊「刪除牌組」按鈕開啟確認對話框
  5. 點擊對話框外部的背景區域（backdrop）
  6. 驗證對話框關閉（或保持開啟，取決於 UX 設計）
  7. 驗證仍停留在設定頁面
  8. 驗證牌組未被刪除

**Expected Results:**
  - 測試帳號登入成功
  - 測試牌組建立成功
  - 成功導航至設定頁面
  - 確認對話框顯示
  - 背景區域可點擊
  - 對話框行為符合設計（通常會關閉）
  - URL 仍為 /decks/{deck_id}/settings
  - 牌組仍存在於列表中

#### 4.5. 6.4.5 測試刪除按鈕 loading 狀態

**File:** `e2e/tests/deck/deck-delete-loading.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 透過 API 建立測試牌組「載入測試」
  3. 導航至牌組設定頁
  4. 點擊「刪除牌組」按鈕開啟確認對話框
  5. 監聽 DELETE API 請求
  6. 點擊「確認」按鈕
  7. 在 API 回應前，驗證「刪除牌組」按鈕顯示「刪除中...」或 loading 狀態
  8. 驗證按鈕在 loading 期間為 disabled 狀態
  9. 等待 API 完成
  10. 驗證成功導航至列表頁

**Expected Results:**
  - 測試帳號登入成功
  - 測試牌組建立成功
  - 成功導航至設定頁面
  - 確認對話框顯示
  - 開始監聽網路請求
  - 確認按鈕可點擊
  - 按鈕文字變更或顯示 loading 指示器
  - 按鈕不可點擊
  - API 請求成功
  - 成功導航至 /decks

### 5. 權限與安全性測試

**Seed:** `e2e/tests/seed.spec.ts`

#### 5.1. 測試未登入用戶無法訪問牌組頁面

**File:** `e2e/tests/deck/deck-auth-guard.spec.ts`

**Steps:**
  1. 清除所有 cookies（確保未登入狀態）
  2. 嘗試直接訪問 /decks
  3. 驗證被重定向至登入頁面 /login
  4. 嘗試訪問 /decks/new
  5. 驗證被重定向至登入頁面 /login
  6. 嘗試訪問任意牌組詳情頁 /decks/123
  7. 驗證被重定向至登入頁面 /login
  8. 嘗試訪問任意牌組設定頁 /decks/123/settings
  9. 驗證被重定向至登入頁面 /login

**Expected Results:**
  - 所有 cookies 已清除
  - 嘗試訪問 /decks
  - URL 變更為 /login
  - 嘗試訪問 /decks/new
  - URL 變更為 /login
  - 嘗試訪問牌組詳情
  - URL 變更為 /login
  - 嘗試訪問牌組設定
  - URL 變更為 /login

#### 5.2. 測試無法訪問其他用戶的牌組

**File:** `e2e/tests/deck/deck-access-control.spec.ts`

**Steps:**
  1. 使用 API 建立第一個測試帳號 userA 並登入
  2. 透過 API 為 userA 建立牌組「用戶 A 的牌組」
  3. 記錄該牌組的 ID
  4. 登出
  5. 使用 API 建立第二個測試帳號 userB 並登入
  6. 嘗試透過 API 訪問 userA 的牌組（GET /decks/:id）
  7. 驗證收到 403 Forbidden 或 404 Not Found 回應
  8. 嘗試在瀏覽器訪問 /decks/:id（userA 的牌組 ID）
  9. 驗證顯示錯誤訊息或重定向
  10. 嘗試透過 API 更新 userA 的牌組（PATCH /decks/:id）
  11. 驗證收到 403 或 404 回應
  12. 嘗試透過 API 刪除 userA 的牌組（DELETE /decks/:id）
  13. 驗證收到 403 或 404 回應

**Expected Results:**
  - userA 帳號建立並登入成功
  - 牌組建立成功
  - 牌組 ID 已記錄
  - 成功登出
  - userB 帳號建立並登入成功
  - API 回應 403 或 404
  - 瀏覽器嘗試訪問
  - 顯示適當的錯誤訊息
  - API 請求被拒絕
  - API 回應 403 或 404
  - API 請求被拒絕
  - API 回應 403 或 404

#### 5.3. 測試 API 錯誤處理（網路錯誤）

**File:** `e2e/tests/deck/deck-network-error.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 導航至 /decks/new
  3. 使用 Playwright 攔截 POST /decks 請求
  4. 模擬網路錯誤（回應 500 Internal Server Error）
  5. 填寫表單並點擊「儲存設定」
  6. 驗證顯示錯誤訊息「建立牌組失敗，請稍後再試」或類似訊息
  7. 驗證仍停留在建立頁面
  8. 驗證表單資料未遺失

**Expected Results:**
  - 測試帳號登入成功
  - 成功導航至建立頁面
  - API 請求攔截成功
  - API 回應 500
  - 表單提交
  - 錯誤訊息顯示
  - URL 仍為 /decks/new
  - 表單欄位保留已輸入的值

### 6. 整合與邊界情況測試

**Seed:** `e2e/tests/seed.spec.ts`

#### 6.1. 測試建立大量牌組

**File:** `e2e/tests/deck/deck-create-bulk.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 透過 API 連續建立 20 個牌組（名稱為「牌組 1」到「牌組 20」）
  3. 導航至牌組列表頁
  4. 驗證頁面能正確顯示所有 20 個牌組
  5. 驗證頁面滾動功能正常
  6. 測試搜尋功能，搜尋「牌組 1」
  7. 驗證只顯示相關牌組（牌組 1, 10-19 包含「牌組 1」字串）

**Expected Results:**
  - 測試帳號登入成功
  - 20 個牌組全部建立成功
  - 成功導航至列表頁
  - 所有 20 個牌組名稱可見
  - 頁面可正常滾動
  - 搜尋框接受輸入
  - 搜尋結果正確過濾

#### 6.2. 測試特殊字元在牌組名稱

**File:** `e2e/tests/deck/deck-name-special-chars.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 導航至 /decks/new
  3. 在牌組名稱輸入框輸入包含特殊字元的名稱「測試 <script>alert('xss')</script> & < > " ' 牌組」
  4. 點擊「儲存設定」
  5. 驗證牌組建立成功
  6. 驗證牌組名稱正確顯示且特殊字元被適當轉義（無 XSS 攻擊）
  7. 導航至牌組列表
  8. 驗證列表中牌組名稱正確顯示
  9. 測試搜尋功能，搜尋「script」
  10. 驗證搜尋結果正確

**Expected Results:**
  - 測試帳號登入成功
  - 成功導航至建立頁面
  - 牌組名稱輸入框接受特殊字元
  - 儲存設定按鈕可點擊
  - 牌組建立成功，導航至詳情頁
  - 特殊字元被正確轉義顯示，無 XSS 執行
  - 成功導航至列表頁
  - 牌組名稱正確且安全地顯示
  - 搜尋框接受輸入
  - 搜尋結果包含該牌組

#### 6.3. 測試超長牌組名稱

**File:** `e2e/tests/deck/deck-name-max-length.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 導航至 /decks/new
  3. 在牌組名稱輸入框輸入超長名稱（例如 200 個字元）
  4. 點擊「儲存設定」
  5. 驗證是否有字元數限制（如顯示錯誤訊息）或允許建立
  6. 若允許建立，驗證牌組列表中名稱顯示是否正常（截斷或全顯示）
  7. 若顯示錯誤，驗證錯誤訊息合理（例如「牌組名稱不得超過 100 字元」）

**Expected Results:**
  - 測試帳號登入成功
  - 成功導航至建立頁面
  - 牌組名稱輸入框接受超長輸入
  - 儲存設定按鈕可點擊
  - API 回應驗證錯誤或成功建立
  - 若成功，列表中名稱以適當方式顯示
  - 若失敗，顯示清晰的錯誤訊息

#### 6.4. 測試空白和空格牌組名稱

**File:** `e2e/tests/deck/deck-name-whitespace.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 導航至 /decks/new
  3. 在牌組名稱輸入框只輸入空格「   」
  4. 點擊「儲存設定」
  5. 驗證顯示驗證錯誤（視為空名稱）
  6. 輸入前後有空格的名稱「  測試牌組  」
  7. 點擊「儲存設定」
  8. 驗證牌組建立成功
  9. 驗證牌組名稱被 trim 處理（前後空格移除）或保留原樣
  10. 導航至列表頁驗證顯示

**Expected Results:**
  - 測試帳號登入成功
  - 成功導航至建立頁面
  - 牌組名稱輸入框接受空格
  - 儲存設定按鈕可點擊
  - 顯示驗證錯誤訊息
  - 牌組名稱輸入框接受輸入
  - 儲存設定按鈕可點擊
  - 牌組建立成功
  - 牌組名稱根據後端邏輯處理
  - 列表中顯示處理後的名稱

#### 6.5. 測試並發刪除牌組

**File:** `e2e/tests/deck/deck-delete-concurrent.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 透過 API 建立測試牌組「並發刪除測試」
  3. 在兩個瀏覽器 context 中登入同一帳號
  4. 在第一個 context 導航至設定頁並開始刪除流程
  5. 在第二個 context 也導航至設定頁並開始刪除流程
  6. 在第一個 context 點擊「確認」刪除
  7. 在第二個 context 點擊「確認」刪除
  8. 驗證其中一個成功刪除，另一個收到適當錯誤（如 404）
  9. 驗證兩個 context 最終都導航至列表頁
  10. 驗證牌組不再存在於列表中

**Expected Results:**
  - 測試帳號登入成功
  - 測試牌組建立成功
  - 兩個 context 都成功登入
  - 第一個 context 在設定頁
  - 第二個 context 在設定頁
  - 第一個刪除請求發送
  - 第二個刪除請求發送
  - 一個成功，一個失敗（或兩個都成功但為冪等操作）
  - 兩個 context 都在列表頁
  - 牌組已從列表中移除

#### 6.6. 測試快速連續點擊儲存按鈕

**File:** `e2e/tests/deck/deck-create-double-submit.spec.ts`

**Steps:**
  1. 使用 API 建立測試帳號並登入
  2. 導航至 /decks/new
  3. 在牌組名稱輸入框輸入「重複提交測試」
  4. 快速連續點擊「儲存設定」按鈕兩次
  5. 驗證只發送一次 API 請求（按鈕應在第一次點擊後變為 disabled）
  6. 驗證只建立一個牌組
  7. 導航至列表頁驗證只有一個「重複提交測試」牌組

**Expected Results:**
  - 測試帳號登入成功
  - 成功導航至建立頁面
  - 牌組名稱輸入框接受輸入
  - 按鈕接受第一次點擊
  - 只發送一次 POST 請求
  - 只建立一個牌組
  - 列表中只顯示一個該名稱的牌組
